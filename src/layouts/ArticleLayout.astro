---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description?: string;
  date: Date;
  author: string;
  tags: string[];
  readingTime: number;
  prevPost?: { slug: string; title: string } | null;
  nextPost?: { slug: string; title: string } | null;
}

const { title, description, date, author, tags, readingTime, prevPost, nextPost } = Astro.props;

const formattedDate = date.toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---
<BaseLayout title={title} description={description}>
  <div id="reading-progress" class="fixed top-0 left-0 h-1 bg-gradient-to-r from-blue-500 to-emerald-500 z-50 transition-all duration-100" style="width: 0%"></div>
  
  <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <header class="mb-12">
      <div class="flex flex-wrap gap-2 mb-6">
        {tags.map(tag => (
          <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-500/10 text-blue-400 border border-blue-500/20">
            {tag}
          </span>
        ))}
      </div>
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white leading-tight mb-6">
        {title}
      </h1>
      <div class="flex items-center gap-4 text-sm text-gray-400">
        <span>{author}</span>
        <span>·</span>
        <time datetime={date.toISOString()}>{formattedDate}</time>
        <span>·</span>
        <span>{readingTime} min de lectura</span>
      </div>
    </header>

    <div class="prose prose-invert prose-lg max-w-none
      prose-headings:text-white prose-headings:font-bold
      prose-h2:text-2xl prose-h2:mt-12 prose-h2:mb-6
      prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-4
      prose-p:text-gray-300 prose-p:leading-relaxed
      prose-a:text-blue-400 prose-a:no-underline hover:prose-a:text-blue-300
      prose-strong:text-white
      prose-code:text-emerald-400 prose-code:bg-gray-800/50 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded
      prose-pre:bg-gray-900 prose-pre:border prose-pre:border-gray-700
      prose-blockquote:border-blue-500 prose-blockquote:text-gray-400
      prose-ul:text-gray-300 prose-ol:text-gray-300
      prose-li:marker:text-blue-400
      prose-hr:border-gray-700
    ">
      <slot />
    </div>

    <nav class="mt-16 pt-8 border-t border-gray-800 grid grid-cols-1 sm:grid-cols-2 gap-6">
      {prevPost && (
        <a href={`/insights/${prevPost.slug}`} class="group p-4 rounded-lg border border-gray-800 hover:border-blue-500/50 transition-colors">
          <div class="text-xs text-gray-500 mb-1">← Anterior</div>
          <div class="text-sm text-white group-hover:text-blue-400 transition-colors font-medium">{prevPost.title}</div>
        </a>
      )}
      {nextPost && (
        <a href={`/insights/${nextPost.slug}`} class="group p-4 rounded-lg border border-gray-800 hover:border-blue-500/50 transition-colors sm:text-right ml-auto w-full">
          <div class="text-xs text-gray-500 mb-1">Siguiente →</div>
          <div class="text-sm text-white group-hover:text-blue-400 transition-colors font-medium">{nextPost.title}</div>
        </a>
      )}
    </nav>
  </article>
</BaseLayout>

<script>
  const progressBar = document.getElementById('reading-progress');
  window.addEventListener('scroll', () => {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
    if (progressBar) progressBar.style.width = `${progress}%`;
  });
</script>
